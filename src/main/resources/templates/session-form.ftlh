<#assign title=(formAction == "create")?then("–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏")>
<#include "base.ftlh">

<@base>
    <div class="card" style="max-width: 600px; margin: 0 auto;">
        <h1>
            <#if formAction == "create">‚ûï –°–æ–∑–¥–∞–Ω–∏–µ —è–∑—ã–∫–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
            <#else>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
            </#if>
        </h1>

        <form id="sessionForm" method="post" action="/sessions" onsubmit="return validateSessionForm()">
            <input type="hidden" name="action" value="${formAction}">
            <#if formAction == "edit" && session??>
                <input type="hidden" name="id" value="${session.id}">
            </#if>

            <div class="form-group">
                <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ *</label>
                <input type="text" id="title" name="title"
                       value="${(session.title)!""}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ"
                       required maxlength="100">
            </div>

            <div class="form-group">
                <label for="language">–Ø–∑—ã–∫ –ø—Ä–∞–∫—Ç–∏–∫–∏ *</label>
                <select id="language" name="language" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</option>
                    <option value="english" <#if (session.language)?? && session.language == "english">selected</#if>>–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                    <option value="russian" <#if (session.language)?? && session.language == "russian">selected</#if>>–†—É—Å—Å–∫–∏–π</option>
                    <option value="spanish" <#if (session.language)?? && session.language == "spanish">selected</#if>>–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                    <option value="french" <#if (session.language)?? && session.language == "french">selected</#if>>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                    <option value="german" <#if (session.language)?? && session.language == "german">selected</#if>>–ù–µ–º–µ—Ü–∫–∏–π</option>
                    <option value="chinese" <#if (session.language)?? && session.language == "chinese">selected</#if>>–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="scheduledTime">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è *</label>
                    <input type="datetime-local" id="scheduledTime" name="scheduledTime"
                           value="${(session.scheduledTime)!""}"
                           required>
                </div>

                <div class="form-group">
                    <label for="duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω) *</label>
                    <input type="number" id="duration" name="duration"
                           value="${(session.durationMinutes)!60}"
                           min="15" max="240" step="15" required>
                </div>
            </div>

            <div class="form-group">
                <label for="partnerId">ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="number" id="partnerId" name="partnerId"
                       value="${(session.partnerId)!""}"
                       placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø–æ–∏—Å–∫–∞">
                <small>–ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ ID –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</small>
            </div>

            <div class="form-group">
                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏</label>
                <textarea id="description" name="description"
                          rows="4"
                          placeholder="–û —á–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≥–æ–≤–æ—Ä–∏—Ç—å? –ö–∞–∫–∏–µ —Ç–µ–º—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Å—É–¥–∏—Ç—å?">${(session.description)!""}</textarea>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button type="submit" class="btn btn-primary">
                    <#if formAction == "create">‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
                    <#else>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </#if>
                </button>
                <a href="/sessions" class="btn btn-outline">‚ùå –û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </div>
</@base>

<style>
    .form-group {
        margin-bottom: 1.5rem;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2c3e50;
    }

    input, select, textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e1e5e9;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #3498db;
    }

    small {
        color: #7f8c8d;
        font-size: 0.8rem;
        margin-top: 0.3rem;
        display: block;
    }
</style>

<script>
    function validateSessionForm() {
        const title = document.getElementById('title').value.trim();
        const language = document.getElementById('language').value;
        const scheduledTime = document.getElementById('scheduledTime').value;
        const duration = document.getElementById('duration').value;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
        if (title.length < 3) {
            alert('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–∑—ã–∫–∞
        if (!language) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏');
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã
        if (!scheduledTime) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏');
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–∞—Ç–∞ –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
        const selectedDate = new Date(scheduledTime);
        const now = new Date();
        if (selectedDate < now) {
            alert('–ù–µ–ª—å–∑—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –≤ –ø—Ä–æ—à–ª–æ–º!');
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        if (duration < 15 || duration > 240) {
            alert('–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 15 –¥–æ 240 –º–∏–Ω—É—Ç');
            return false;
        }

        return true;
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è)
    document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('scheduledTime').min = now.toISOString().slice(0, 16);
    });
</script>